name: Check Markdown links

on: 
  pull_request:
    # The branches below must be a subset of the branches above
    branches: [ main, staging ]
  schedule:
  # Run everyday at 9:00 AM (See https://pubs.opengroup.org/onlinepubs/9699919799/utilities/crontab.html#tag_20_25_07)
  - cron: "0 9 * * *"

jobs:
  markdown-link-check:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: Setup Hugo
      uses: peaceiris/actions-hugo@v2
      with:
        hugo-version: '0.76.5'
        extended: true

    - name: Build
      run: |
          cd docs
          git submodule update -f --init --recursive && npm install postcss-cli && hugo --gc --minify
          echo "docs.umh.app" > public/CNAME

    - name: Check broken links
      run: |
          export INPUT_URL="https://docs.umh.app"
          export INPUT_PAGES_PATH="docs/public"
          export INPUT_CMD_PARAMS="--verbose --buffer-size=8192 --concurrency=10 --skip-tls-verification"
          wget -qO- https://raw.githubusercontent.com/ruzickap/action-my-broken-link-checker/v1/entrypoint.sh | bash
