apiVersion: apps/v1
kind: Deployment
metadata:
  # This is the name of the component, it should be unique within the namespace (63 chars max as per RFC 1035/1123)
  name: dfc-1db88f9f-789d-45fa-b095-cf579cc9074d-mqtt-t-kafka-historian
  # To be scheduled in the open-source namespace
  namespace: united-manufacturing-hub
  labels:
    # This does not change over time
    data-flow-component-uuid: 1db88f9f-789d-45fa-b095-cf579cc9074d
    # This is the random UUID of the version of the component
    data-flow-component-version-uuid: 83bd6ace-58f7-4572-9ab4-f8a9237a47dd
    # Timestamp of last change to the component in unix milliseconds since epoch
    data-flow-version: '1724661195274'
    # Generic label to indicate that this is a data flow component
    is-data-flow-component: 'true'
    # Required for mgmtcompanion to manage the component
    managed-by: mgmtcompanion
    # Do not allow mgmtcompanion to modify the component
    data-flow-component-is-read-only: true
    # The type of the component
    data-flow-component-type: bridge
spec:
  replicas: 1
  selector:
    matchLabels:
      data-flow-component-uuid: 1db88f9f-789d-45fa-b095-cf579cc9074d
  template:
    metadata:
      labels:
        # This does not change over time
        data-flow-component-uuid: 1db88f9f-789d-45fa-b095-cf579cc9074d
        # This is the random UUID of the version of the component
        data-flow-component-version-uuid: 83bd6ace-58f7-4572-9ab4-f8a9237a47dd
        # Timestamp of last change to the component in unix milliseconds since epoch
        data-flow-version: '1724661195274'
        # Generic label to indicate that this is a data flow component
        is-data-flow-component: 'true'
        # Required for mgmtcompanion to manage the component
        managed-by: mgmtcompanion
        # Do not allow mgmtcompanion to modify the component
        data-flow-component-is-read-only: true
        # The type of the component
        data-flow-component-type: bridge
    spec:
      volumes:
        - name: config
          configMap:
            name: dfc-1db88f9f-789d-45fa-b095-cf579cc9074d-mqtt-t-kafka-historian
            defaultMode: 420
      containers:
        - name: dfc-1db88f9f-789d-45fa-b095-cf579cc9074d-mqtt-t-kafka-historian
          image: management.umh.app/oci/united-manufacturing-hub/benthos-umh:0.3.12
          ports:
            - name: http
              containerPort: 4195
              protocol: TCP
          volumeMounts:
            - name: config
              readOnly: true
              mountPath: /benthos.yaml
              subPath: benthos.yaml
          livenessProbe:
            httpGet:
              path: /ping
              port: http
              scheme: HTTP
            timeoutSeconds: 1
            periodSeconds: 10
            successThreshold: 1
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /ready
              port: http
              scheme: HTTP
            timeoutSeconds: 1
            periodSeconds: 10
            successThreshold: 1
            failureThreshold: 3
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          imagePullPolicy: IfNotPresent
          resources:
            limits:
              cpu: 500m
              memory: 450Mi
            requests:
              cpu: 400m
              memory: 300Mi
      restartPolicy: Always
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1
  revisionHistoryLimit: 10
  progressDeadlineSeconds: 600
